{% extends 'base.html' %}
{% load humanize %}

{% block pagecontent %}
<div class="container">
  <div class="category-swipe">
    <div class="category-tabs">
      {% for category in categories %}
        <div class="category-tab" data-category="{{ category }}">{{ category }}</div>
      {% endfor %}
    </div>
  </div>

  <div class="menu-items">
    <div id="items-container">
      {% for category in categories %}
        <div class="category-section" id="category-{{ category }}">
          <h2>{{ category }}</h2>
          <table class="table table-striped mobile-friendly-table" id="tbl-{{category}}">
            <thead>
              <tr>
                <th>Item</th>
                <th></th>
                {% if request.user.is_staff %}
                <th>Modify</th>
                <th>Remove</th>
                {% endif %}
              </tr>
            </thead>
            <tbody>
              {% for item in item_list %}
                {% if item.category == category %}
                  <tr>
                    <td class="item-info">
                      <p class="item-name">{{ item.name }}</p>
                      <p class="item-price">{{ item.price }} Ft</p>
                    </td>
                    <td class="cart-button">
                      <a href="{% url 'add_to_cart' item.id %}">
                        <img src="static\pics\cart.png" alt="Add to cart" width="30" height="30">
                      </a>
                    </td>
                    {% if request.user.is_staff %}
                    <td>
                      <input type="hidden" id="editdata" name="editdata" value="{{ item.id }}" />
                      <button
                        type="submit"
                        class="btn btn-primary modify-button"
                        id="modify-button"
                        onclick="openForm('myModal')"
                      >
                        Modify
                      </button>
                    </td>
                    <td>
                      <form method="post" class="form-inline">
                        {% csrf_token %}
                        <input type="hidden" name="remove" value="{{ item.id }}" />
                        <button type="submit" class="btn btn-danger">Remove</button>
                      </form>
                    </td>
                    {% endif %}
                  </tr>
                {% endif %}
              {% endfor %}
            </tbody>
          </table>
          
          
        </div>
      {% endfor %}
    </div>
  </div>
</div>
    {% if request.user.is_staff %}
    <button class="btn btn-primary" type="submit" onclick="openForm('AddModal')">
      Add
    </button>

    {% include "partials/add_modal.html" %}

    {% include "partials/modify_modal.html" %}
    
    {% endif %} 

    <script>
      var categoryTabs = document.querySelectorAll(".category-tab");
      categoryTabs.forEach(function (tab) {
        tab.addEventListener("click", function () {
          var category = tab.getAttribute("data-category");
          var categorySection = document.getElementById("category-" + category);
          if (categorySection) {
            window.scrollTo({ top: categorySection.offsetTop, behavior: "smooth" });
          }
        });
      });
    </script>
    
    <style>
      .category-swipe {
        display: flex;
        overflow-x: auto;
        white-space: nowrap;
      }
    
      .category-tabs {
        display: flex;
        padding: 10px;
      }
    
      .category-tab {
        cursor: pointer;
        padding: 10px 20px;
        border: 1px solid #ccc;
        margin: 0 10px;
        border-radius: 5px;
        background-color: #f2f2f2;
      }
    
      .menu-items {
        padding: 20px;
      }
    
      .category-section {
        margin-bottom: 40px;
      }



      .mobile-friendly-table {
        border-collapse: collapse;
        width: 100%;
      }
      
      .mobile-friendly-table th, .mobile-friendly-table td {
        padding: 10px;
        text-align: left;
      }
      
      .item-info {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
      }
      
      .item-name {
        font-weight: bold;
      }
      
      .cart-button {
        text-align: right;
      }
      


      .mobile-friendly-table {
        border-collapse: collapse;
        width: 100%;
      }
      
      .mobile-friendly-table th, .mobile-friendly-table td {
        padding: 10px;
        text-align: left;
      }
      
      .item-info {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
      }
      
      .item-name {
        font-weight: bold;
      }
      
      .cart-button {
        text-align: right;
      }
      
      /* Mobile-first responsive design */
      @media screen and (max-width: 768px) {
        .item-info {
          flex-direction: column;
        }
      
        .cart-button {
          text-align: center;
          margin-top: 10px;
        }
      }
      
      /* Desktop styles (for screens wider than 768px) */
      @media screen and (min-width: 769px) {
        .mobile-friendly-table {
          max-width: 100%;
        }
      
        .item-info {
          display: flex;
          flex-direction: row;
          justify-content: space-between; /* Align price to the left of the cell */
          align-items: center;
        }
      
        .cart-button {
          text-align: right;
        }
      }
      
    </style>
    
    <script>
      $(document).on("click", ".modify-button", function () {
        var itemInfo = $(this).closest("tr").find(".item-info");
        var tdNameValue = itemInfo.find(".item-name").text();
        var tdPriceValue = itemInfo.find(".item-price").text().slice(0, -3);
        var inputValue = $(this).closest("tr").find("input#editdata").val();
    
        console.log(tdNameValue);
        console.log(tdPriceValue);
    
        document.getElementById("editItemID").value = inputValue;
        document.getElementById("name").value = tdNameValue;
        document.getElementById("price").value = tdPriceValue;
    
        document.getElementById("myModal").style.display = "block";
      });
    </script>
    
    
    <script>
  // Function to show or hide tables based on the selected categories
  function filterCategories() {
    var checkboxes = document.querySelectorAll('input[name="category"]');
    checkboxes.forEach(function(checkbox) {
      var category = checkbox.value;
      var table = document.getElementById('tbl-' + category);
      if (checkbox.checked) {
        table.style.display = 'table';
      } else {
        table.style.display = 'none';
      }
    });
  }

  // Add event listener to the checkboxes
  var checkboxes = document.querySelectorAll('input[name="category"]');
  checkboxes.forEach(function(checkbox) {
    checkbox.addEventListener('change', filterCategories);
  });
</script>
    
    {% endblock %}
