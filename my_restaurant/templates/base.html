<!-- djangotemplates/example/templates/base.html -->

{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MyPub - {% block title %}{% endblock %}</title>
    {% load my_restaurant_tags %}

    <script src="https://js.stripe.com/v3/"></script>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <style>
      .navbar-collapse.collapse {
        display: none;
      }

    </style>


    <script>
      function redirectToCart() {
        
        if (window.innerWidth <= 768) {
          window.location.href = '/cart'; 
        } else {
          toggleCart(); 
        }
      }
    </script>

    <script>
      function toggleCart() {
        var div = document.querySelector('.cart_preview');
        if (div.style.display === 'none') {
          div.style.display = 'block';
        } else {
          div.style.display = 'none';
        }
      }
    </script>

    <script>
      function positionDiv() {
          var preview = document.querySelector('.preview');
          var cartPreview = document.querySelector('.cart_preview');
          var previewRect = preview.getBoundingClientRect();
          var cartPreviewHeight = cartPreview.offsetHeight;
          
          cartPreview.style.position = 'fixed';
          cartPreview.style.right = '0';
          cartPreview.style.bottom = '0';
          cartPreview.style.overflowY = 'auto';
          cartPreview.style.padding = '20px';
          cartPreview.style.color = '#fff';
          
          cartPreview.style.left = (previewRect.right + 10) + 'px';  // Adjust the 10px as needed
      }
  
      window.addEventListener('load', positionDiv);
      window.addEventListener('resize', positionDiv);
  
      document.addEventListener('click', function (event) {
          var cartPreview = document.querySelector('.cart_preview');
          var preview = document.querySelector('.preview');
  
          if (!cartPreview.contains(event.target) && !preview.contains(event.target)) {
              cartPreview.style.display = 'none';
          }
      });
  </script>
  

    <script>
      // Function to toggle the theme
      function toggleTheme() {
        const body = document.body;
        if (body.classList.contains('dark-mode')) {
          body.classList.remove('dark-mode');
        } else {
          body.classList.add('dark-mode');
        }
      }
    
      // Attach the toggleTheme function to the button click event
      document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
    </script>
    

    <!-- This is how to include a static file -->
    <link rel="stylesheet" href="/static/css/bootstrap.min.css" />
    <link rel="stylesheet" href="{% static 'css/main.css' %}" type="text/css" />
    <link rel="stylesheet" href="{% static 'css/home.css' %}" type="text/css" />
    <link rel="stylesheet"href="{% static 'css/dropdown.css' %}"type="text/css"/>
    <link rel="stylesheet" href="/static/css/order.css" type="text/css" />
    <!--<link rel="stylesheet" href="{% static 'css/navbar_v2.css' %}" type="text/css"/>-->
    <link rel="stylesheet" href="{% static 'css/navmenu.css' %}" type="text/css"/>
    <script type="text/javascript" src="{% static 'css/scripts.js' %}"></script>
    <script type="text/javascript" src="{% static 'css/navmenu.js' %}"></script>


    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/ju/dt-1.11.4/datatables.min.css"/>
    <script type="text/javascript" src="https://cdn.datatables.net/v/ju/dt-1.11.4/datatables.min.js" ></script>

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous"/>
    





    <script>
      // Function to show the location prompt
      function showLocationPrompt() {
          const locationPrompt = document.getElementById('location-prompt');
          locationPrompt.style.display = 'block';
  
          // Handle the "Allow" button click
          document.getElementById('allow-location').addEventListener('click', () => {
              getLocation();
              locationPrompt.style.display = 'none';
          });
  
          // Handle the "Deny" button click
          document.getElementById('deny-location').addEventListener('click', () => {
              locationPrompt.style.display = 'none';
              // Redirect or handle the denial as needed
          });
      }
  
      // Function to get user's location
      function getLocation() {
          if (navigator.geolocation) {
              navigator.geolocation.getCurrentPosition(
                  function (position) {
                      // Handle successful location retrieval
                      const latitude = position.coords.latitude;
                      const longitude = position.coords.longitude;
                      // Perform any additional logic or redirection here
                      console.log(`User's location: Latitude=${latitude}, Longitude=${longitude}`);
                  },
                  function (error) {
                      // Handle location retrieval error
                      console.error('Error getting location:', error.message);
                  }
              );
          } else {
              console.error('Geolocation is not supported by this browser.');
          }
      }
  
      // Check if the user is trying to access restricted links
      const restrictedUrls = ['/table/scan/', '/order'];
      const currentUrl = window.location.pathname;
      if (restrictedUrls.includes(currentUrl)) {
          showLocationPrompt();
      }
  </script>





    
  </head>
  <body >
    <!--
    <header>
      <nav class="navbar navbar-expand-lg navbar-dark">
        <button
          class="navbar-toggler"
          type="button"
          data-toggle="collapse"
          data-target="#navbarText"
          aria-controls="navbarText"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarText">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
              <a class="nav-link" href="{% url 'home' %}"
                >Home <span class="sr-only">(current)</span></a
              >
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown">
                Menu
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a class="dropdown-item" href="{% url 'drinks' %}">Drinks</a>
                <a class="dropdown-item" href="{% url 'menu' %}">Food</a>
                {% if user.is_authenticated %}
                <a class="dropdown-item" href="{% url 'order' %}">Order</a>
                {% endif %}
              </div>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'about' %}">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin">Admin</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/all_orders">Orders</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/all_reservations">All reservation</a>
            </li>
          </ul>

          <ul class="navbar-nav ml-auto">
            {% if user.is_authenticated %}
            <li class="nav-item"><a class="nav-link" href="{% url 'cart' %}">Cart</a></li>
            <li class="nav-item"> <a class="nav-link" href="{% url 'available_tables' %}">Reservation</a></li>
            {% if user.is_authenticated %}
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarDropdownMenuLink"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                Profile
              </a>
              <div
                class="dropdown-menu dropdown-menu-right"
                aria-labelledby="navbarDropdownMenuLink"
              >
                <a class="dropdown-item" href="{% url 'profile' %}">Profile</a>
                <a class="dropdown-item" href="{% url 'previous_orders' %}">previous_orders</a>
                <a class="dropdown-item" href="{% url 'my_reservations' %}">Reservations</a>
                <a class="dropdown-item" href="{% url 'logout' %}">Logout</a>
              </div>
            </li>
            {% endif %}{% else %}
            <li class="nav-item dropdown">
              <a class="nav-link" href="{% url 'login' %}">Login</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link" href="{% url 'register' %}">Register</a>
            </li>

            {% endif %}
          </ul>
        </div>
      </nav>
    </header>
    -->

    <!--TODO class active JS-->


    <header>
      <nav id='cssmenu'>
      <div id="head-mobile"></div>
      <div class="button"></div>
      
      <ul>
        <li class="active">
          <a class="nav-link" href="{% url 'home' %}">{% trans "Home" %} </a>
        </li>
        <li><a href='#'>Menu</a>
          <ul>
            <li><a  href="{% url 'drinks' %}">{% trans "Drinks" %}</a></li>
            <li><a  href="{% url 'menu' %}">{% trans "Foods" %}</a></li>
            {% if user.is_authenticated %}
            <li><a  href="{% url 'order' %}">{% trans "Order" %}</a></li>
            {% endif %} 
              </li>
          </ul>
        </li>
        <li><a href="{% url 'about' %}">{% trans "About" %}</a></li>
        <li><a href="{% url 'gallery' %}">{% trans "Gallery" %}</a></li>
        {% if request.user.is_staff %}
        <li><a href='#'>Admin</a>
          <ul>
          <li class="nav-item"><a  href="/admin">{% trans "Admin" %}</a></li>
          <li class="nav-item"><a  href="{% url 'create_coupon' %}">{% trans "Create Coupon" %}</a></li>
          <li class="nav-item"><a  href="/dashboard">{% trans "Dashboard" %}</a></li>
          </ul>
        </li>
        <li><a href="/all_orders">Orders<span class="order-count">{% active_order_count %}</span></a></li>
        <li><a href="/all_reservations">{% trans "All Reservation" %}</a></li>
        {% endif %} 
      </ul> 
      <ul class = "right">
        {% if user.is_authenticated %}
        
        <li class="preview" onclick="redirectToCart()">
          <a>
            <span class="cart-icon">{% trans "Cart" %}<span class="cart-count">{% cart_item_count %}</span>
          </a>
        </li>      
        <li><a href="{% url 'available_tables' %}">{% trans "Reservation" %}</a></li>
        <li><a href='#'>Profile</a>
          <ul>
            <li><a class="dropdown-item" href="{% url 'profile' %}">{% trans "Profile" %}</a></li>
            <li><a class="dropdown-item" href="{% url 'previous_orders' %}">{% trans "Previous Orders" %}</a></li>
            <li><a class="dropdown-item" href="{% url 'my_reservations' %}">{% trans "Reservations" %}</a></li>
            <li><a class="dropdown-item" href="{% url 'logout' %}">{% trans "Logout" %}</a></li>
          </ul>
        </li>
        <li class="language-dropdown">
          <img src="static/pics/{{user.profile.language}}.png" alt="English" id="current-language" width=30px></img>
          {% csrf_token %}
          <ul class="language-options">
            {% for choice in user.profile.LANGUAGE_CHOICES %}
              <li>
                <a href="change_language" class="language" data-language="{{ choice.0 }}">
                  <img src="static/pics/{{choice.0}}.png" alt="{{ choice.1 }}" width=30px></img>

                </a>
              </li>
            {% endfor %}
          </ul>
        </li>
        {% else %}
          <li><a href="{% url 'login' %}">{% trans "Login" %}</a></li>
          <li><a href="{% url 'register' %}">{% trans "Register" %}</a></li>

        {% endif %}

      </ul>
      </nav>

      <!-- Add this JavaScript code to your HTML file -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
$(document).ready(function() {
  $("#current-language").click(function() {
    $(".language-options").toggle();
  });

  $(".language-options a").click(function() {
    var newLanguage = $(this).data("language");
    
    var csrfToken = $("[name=csrfmiddlewaretoken]").val();
    var data = {
      language: newLanguage,
      csrfmiddlewaretoken: csrfToken
    };
    
    $.post("{% url 'change_language' %}", data, function(data) {
      location.reload();
    });
  });
});
</script>


      
    </header>
    {% cart_preview  %}

    <button id="dark-mode-toggle" onclick="toggleTheme()">{% trans "Toggle Dark Mode" %}</button>

       
    <!-- IS_LOGGED_IN flag
    {% if user.is_authenticated %} Hi {{ user.username }}! {% else %}
    <p>You are not logged in</p>
    {%endif%}
    -->
    <div class="container">{% block pagecontent %} {% endblock %}</div>
  </body>
</html>
